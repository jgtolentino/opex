<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebToDesign</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 14px;
      line-height: 1.5;
      color: #333;
      background: #ffffff;
      padding: 16px;
      overflow-x: hidden;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-width: 100%;
    }

    h1 {
      font-size: 18px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 12px;
      color: #666;
      margin-bottom: 16px;
    }

    .section {
      background: #f8f8f8;
      border-radius: 8px;
      padding: 16px;
      border: 1px solid #e5e5e5;
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 12px;
    }

    label {
      font-size: 12px;
      font-weight: 500;
      color: #666;
    }

    input[type="url"],
    input[type="text"],
    select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 13px;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: #18A0FB;
    }

    input::placeholder {
      color: #999;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 0;
    }

    input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    .checkbox-group label {
      cursor: pointer;
      color: #333;
      font-weight: 400;
    }

    .button {
      width: 100%;
      padding: 12px 16px;
      background: #18A0FB;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .button:hover {
      background: #0D8BE0;
    }

    .button:active {
      background: #0B7AC9;
    }

    .button:disabled {
      background: #ccc;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .button-secondary {
      background: #ffffff;
      color: #333;
      border: 1px solid #ddd;
    }

    .button-secondary:hover {
      background: #f5f5f5;
    }

    .button-secondary:disabled {
      background: #f5f5f5;
      color: #999;
    }

    .status {
      padding: 12px;
      background: #f0f7ff;
      border: 1px solid #b3d9ff;
      border-radius: 6px;
      font-size: 12px;
      color: #0066cc;
      display: none;
      align-items: center;
      gap: 8px;
    }

    .status.visible {
      display: flex;
    }

    .status.error {
      background: #fff0f0;
      border-color: #ffb3b3;
      color: #cc0000;
    }

    .status.success {
      background: #f0fff0;
      border-color: #b3ffb3;
      color: #00aa00;
    }

    .status .icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background: #e5e5e5;
      border-radius: 2px;
      overflow: hidden;
      display: none;
      margin-top: 8px;
    }

    .progress-bar.visible {
      display: block;
    }

    .progress-fill {
      height: 100%;
      background: #18A0FB;
      transition: width 0.3s ease;
      width: 0%;
    }

    .help-text {
      font-size: 11px;
      color: #888;
      margin-top: 4px;
    }

    .divider {
      height: 1px;
      background: #e5e5e5;
      margin: 16px 0;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      background: #e5e5e5;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
    }

    .badge.beta {
      background: #fff3cd;
      color: #856404;
    }

    .options-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .import-methods {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }

    .method-card {
      padding: 12px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .method-card:hover {
      border-color: #18A0FB;
      background: #f0f7ff;
    }

    .method-card.selected {
      border-color: #18A0FB;
      background: #f0f7ff;
    }

    .method-title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .method-desc {
      font-size: 11px;
      color: #666;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .spinner {
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div>
      <h1>WebToDesign <span class="badge beta">Beta</span></h1>
      <p class="subtitle">Convert websites to editable Figma designs</p>
    </div>

    <!-- Import Method Selection -->
    <div class="section">
      <div class="section-title">
        <span>üì•</span>
        <span>Import Method</span>
      </div>
      <div class="import-methods">
        <div class="method-card selected" data-method="url">
          <div class="method-title">URL Import (Demo)</div>
          <div class="method-desc">Import any public website by URL</div>
        </div>
        <div class="method-card" data-method="snapshot">
          <div class="method-title">Snapshot Upload</div>
          <div class="method-desc">Upload a .w2d snapshot from browser extension</div>
        </div>
      </div>
    </div>

    <!-- URL Import Form -->
    <div class="section" id="url-form">
      <div class="section-title">
        <span>üåê</span>
        <span>Website URL</span>
      </div>

      <div class="input-group">
        <label for="url-input">Enter website URL</label>
        <input
          id="url-input"
          type="url"
          placeholder="https://example.com"
          value="https://example.com"
        />
        <div class="help-text">Works best with public, marketing websites</div>
      </div>

      <div class="input-group">
        <label for="viewport-select">Viewport Size</label>
        <select id="viewport-select">
          <option value="0">Desktop (1440px)</option>
          <option value="1">Laptop (1280px)</option>
          <option value="2">Tablet (768px)</option>
          <option value="3">Mobile (375px)</option>
          <option value="4">Mobile (360px)</option>
        </select>
      </div>

      <div class="options-grid">
        <div class="checkbox-group">
          <input type="checkbox" id="include-images" checked>
          <label for="include-images">Include images</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="full-page">
          <label for="full-page">Full page</label>
        </div>
      </div>
    </div>

    <!-- Snapshot Upload Form -->
    <div class="section" id="snapshot-form" style="display: none;">
      <div class="section-title">
        <span>üì¶</span>
        <span>Upload Snapshot</span>
      </div>

      <div class="input-group">
        <label for="file-input">Select .w2d file</label>
        <input
          id="file-input"
          type="file"
          accept=".w2d,.json"
        />
        <div class="help-text">Capture private pages using the browser extension</div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div style="display: flex; gap: 8px;">
      <button id="import-btn" class="button">
        <span id="import-icon">üöÄ</span>
        <span id="import-text">Import to Figma</span>
      </button>
    </div>

    <!-- Status Display -->
    <div id="status" class="status">
      <span class="icon">‚ÑπÔ∏è</span>
      <div style="flex: 1;">
        <div id="status-message">Ready to import</div>
        <div class="progress-bar" id="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
      </div>
    </div>

    <!-- Info -->
    <div class="divider"></div>
    <div style="font-size: 11px; color: #888; text-align: center;">
      <p>MVP Demo Version - Backend API integration coming soon</p>
      <p style="margin-top: 4px;">Currently generates demo layouts to test conversion</p>
    </div>
  </div>

  <script>
    // UI State
    let currentMethod = 'url'
    let isImporting = false

    // Elements
    const urlForm = document.getElementById('url-form')
    const snapshotForm = document.getElementById('snapshot-form')
    const urlInput = document.getElementById('url-input')
    const viewportSelect = document.getElementById('viewport-select')
    const includeImagesCheckbox = document.getElementById('include-images')
    const fullPageCheckbox = document.getElementById('full-page')
    const fileInput = document.getElementById('file-input')
    const importBtn = document.getElementById('import-btn')
    const importIcon = document.getElementById('import-icon')
    const importText = document.getElementById('import-text')
    const statusDiv = document.getElementById('status')
    const statusMessage = document.getElementById('status-message')
    const progressBar = document.getElementById('progress-bar')
    const progressFill = document.getElementById('progress-fill')

    // Method cards
    const methodCards = document.querySelectorAll('.method-card')

    // Viewport presets
    const viewports = [
      { name: 'Desktop (1440px)', width: 1440, height: 900 },
      { name: 'Laptop (1280px)', width: 1280, height: 800 },
      { name: 'Tablet (768px)', width: 768, height: 1024 },
      { name: 'Mobile (375px)', width: 375, height: 667 },
      { name: 'Mobile (360px)', width: 360, height: 640 }
    ]

    // Method selection
    methodCards.forEach(card => {
      card.addEventListener('click', () => {
        methodCards.forEach(c => c.classList.remove('selected'))
        card.classList.add('selected')

        currentMethod = card.dataset.method

        if (currentMethod === 'url') {
          urlForm.style.display = 'block'
          snapshotForm.style.display = 'none'
        } else {
          urlForm.style.display = 'none'
          snapshotForm.style.display = 'block'
        }
      })
    })

    // Import button click
    importBtn.addEventListener('click', async () => {
      if (isImporting) return

      if (currentMethod === 'url') {
        await importFromURL()
      } else {
        await importFromSnapshot()
      }
    })

    // Import from URL
    async function importFromURL() {
      const url = urlInput.value.trim()

      if (!url) {
        showStatus('Please enter a URL', 'error')
        return
      }

      // Validate URL
      try {
        new URL(url)
      } catch {
        showStatus('Invalid URL format', 'error')
        return
      }

      const viewportIndex = parseInt(viewportSelect.value)
      const viewport = viewports[viewportIndex]

      const options = {
        url,
        viewport,
        theme: 'auto',
        includeImages: includeImagesCheckbox.checked,
        fullPage: fullPageCheckbox.checked
      }

      setImporting(true)
      showStatus('Starting import...', 'info', 0)

      // Send to plugin code
      parent.postMessage({
        pluginMessage: { type: 'import-url', payload: options }
      }, '*')
    }

    // Import from snapshot
    async function importFromSnapshot() {
      const file = fileInput.files[0]

      if (!file) {
        showStatus('Please select a file', 'error')
        return
      }

      try {
        const text = await file.text()
        const snapshot = JSON.parse(text)

        setImporting(true)
        showStatus('Importing snapshot...', 'info', 0)

        parent.postMessage({
          pluginMessage: { type: 'import-snapshot', payload: snapshot }
        }, '*')
      } catch (error) {
        showStatus('Failed to read snapshot file', 'error')
      }
    }

    // Receive messages from plugin code
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage

      if (!msg) return

      switch (msg.type) {
        case 'status':
          showStatus(msg.payload.message, 'info', msg.payload.progress)
          break

        case 'complete':
          setImporting(false)
          showStatus(msg.payload.message, 'success', 100)
          setTimeout(() => {
            hideStatus()
          }, 3000)
          break

        case 'error':
          setImporting(false)
          showStatus(msg.payload.message, 'error')
          break
      }
    }

    // UI helpers
    function setImporting(importing) {
      isImporting = importing

      if (importing) {
        importBtn.disabled = true
        importIcon.innerHTML = '<span class="spinner">‚è≥</span>'
        importText.textContent = 'Importing...'
      } else {
        importBtn.disabled = false
        importIcon.textContent = 'üöÄ'
        importText.textContent = 'Import to Figma'
      }
    }

    function showStatus(message, type = 'info', progress) {
      statusDiv.className = `status visible ${type}`
      statusMessage.textContent = message

      // Update icon
      const icon = statusDiv.querySelector('.icon')
      if (type === 'error') {
        icon.textContent = '‚ùå'
      } else if (type === 'success') {
        icon.textContent = '‚úÖ'
      } else {
        icon.textContent = '‚ÑπÔ∏è'
      }

      // Progress bar
      if (progress !== undefined && progress >= 0) {
        progressBar.classList.add('visible')
        progressFill.style.width = `${progress}%`
      } else {
        progressBar.classList.remove('visible')
      }
    }

    function hideStatus() {
      statusDiv.classList.remove('visible')
      progressBar.classList.remove('visible')
    }
  </script>
</body>
</html>
