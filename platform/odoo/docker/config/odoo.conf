# Odoo CE+OCA 18.0 Configuration
#
# This configuration provides:
# - Complete isolation from odoo.com services
# - Production-ready settings
# - Security hardening
# - OCA addons support

[options]

# ============================================================================
# Database Configuration
# ============================================================================
db_host = postgres
db_port = 5432
db_user = odoo
db_password = odoo
db_name = False
db_template = template0
db_maxconn = 64
db_maxconn_gevent = False

# List of databases to serve (empty = all)
# In production, set this to your specific database name
# dbfilter = ^yourdb$

# ============================================================================
# Server Configuration
# ============================================================================

# HTTP(S) settings
http_enable = True
http_interface = 0.0.0.0
http_port = 8069
longpolling_port = 8072

# Proxy mode (REQUIRED when behind nginx/caddy)
proxy_mode = True

# ============================================================================
# Security & Access Control
# ============================================================================

# Disable database manager (recommended for production)
# This prevents users from creating/dropping databases via web UI
list_db = False

# Admin master password
# Change this immediately!
# Or set via environment variable: ADMIN_PASSWORD
admin_passwd = changeme_master_password_here

# ============================================================================
# URL Configuration (CRITICAL for odoo.com isolation)
# ============================================================================

# This is THE most important setting for domain binding
# Set this to your actual domain and freeze it
# This prevents Odoo from rewriting URLs back to odoo.com

# In Odoo 18, we set this via System Parameters instead:
# web.base.url = https://erp.yourdomain.com
# web.base.url.freeze = True
#
# But we can also enforce it here for extra safety:
# (Note: This may not work in all Odoo versions, use System Parameters as primary method)

# ============================================================================
# Addons Path
# ============================================================================

# Order matters! First path has priority.
# 1. Your custom addons (ipai_branding_cleaner, etc.)
# 2. OCA addons
# 3. Core Odoo addons

addons_path = /mnt/extra-addons,/mnt/oca-addons,/usr/lib/python3/dist-packages/odoo/addons

# ============================================================================
# Performance & Workers
# ============================================================================

# Workers (multi-process mode)
# Formula: (num_cores * 2) + 1
# For 4 cores: 9 workers
# For development: workers = 0 (single-process mode)
workers = 4

# Worker limits
limit_memory_hard = 2684354560  # 2.5 GB
limit_memory_soft = 2147483648  # 2 GB
limit_request = 8192
limit_time_cpu = 600           # 10 minutes
limit_time_real = 1200         # 20 minutes
limit_time_real_cron = 3600    # 1 hour for cron jobs

# Max cron threads
max_cron_threads = 2

# ============================================================================
# Logging
# ============================================================================

# Log level (debug, info, warn, error, critical)
# Use 'info' for production, 'debug' for troubleshooting
log_level = info

# Log file (or set to False to use stdout)
logfile = /var/log/odoo/odoo.log

# Log rotation
logrotate = True

# Log database queries (only for debugging!)
# log_db = True

# ============================================================================
# Email Configuration
# ============================================================================

# SMTP settings (configure for your email provider)
email_from = noreply@yourdomain.com
smtp_server = localhost
smtp_port = 25
smtp_ssl = False
smtp_user = False
smtp_password = False

# ============================================================================
# Session & Security
# ============================================================================

# Session timeout (seconds)
# 7 days = 604800
# 30 days = 2592000
session_timeout = 604800

# GeoIP database (optional, for security)
# geoip_database = /usr/share/GeoIP/GeoLite2-City.mmdb

# ============================================================================
# Demo Data & Testing
# ============================================================================

# Disable demo data (recommended for production)
without_demo = all

# Test enable (only for development/CI)
# test_enable = False

# ============================================================================
# Translations
# ============================================================================

# Load language (comma-separated)
# load_language = en_US,es_ES,fr_FR

# Translation import overwrite
# overwrite_existing_translations = False

# ============================================================================
# Development Settings (disable in production!)
# ============================================================================

# Developer mode (NEVER enable in production!)
# dev_mode = False

# Auto-reload on code changes (development only)
# dev_mode = reload

# ============================================================================
# Data Directory
# ============================================================================

# Filestore and session data
data_dir = /var/lib/odoo

# ============================================================================
# Report & PDF Generation
# ============================================================================

# Report directory
reportgz = False

# ============================================================================
# Server-Wide Modules
# ============================================================================

# Server-wide modules to load on startup
# Add 'web' and your branding cleaner here
server_wide_modules = base,web
