{
  "name": "Finance Handoff Alerts (Email)",
  "nodes": [
    {
      "id": "NotionTrigger_TaskUpdated",
      "name": "Watch Finance Tasks",
      "type": "n8n-nodes-base.notionTrigger",
      "typeVersion": 1,
      "position": [260, 300],
      "credentials": {
        "notionApi": {
          "id": "1",
          "name": "Notion API"
        }
      },
      "parameters": {
        "databaseId": "YOUR_FINANCE_TASKS_DB_ID",
        "events": [
          "pageUpdated"
        ],
        "simplifyOutput": true
      },
      "notes": "Triggers when any page in Finance Tasks DB is updated"
    },
    {
      "id": "If_StatusDone",
      "name": "Status = Done?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [500, 300],
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.properties?.Status?.name || $json.properties?.Status }}",
              "operation": "equal",
              "value2": "Done"
            }
          ]
        }
      },
      "notes": "Only proceed if Status changed to 'Done'"
    },
    {
      "id": "If_HasNextStep",
      "name": "Has Next Step?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [740, 300],
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.properties?.['Next Step']?.relation?.[0]?.id || '' }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "notes": "Check if task has a Next Step relation"
    },
    {
      "id": "Notion_GetNextStep",
      "name": "Get Next Step Task",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [980, 300],
      "credentials": {
        "notionApi": {
          "id": "1",
          "name": "Notion API"
        }
      },
      "parameters": {
        "resource": "page",
        "operation": "get",
        "pageId": "={{ $json.properties['Next Step'].relation[0].id }}",
        "simplifyOutput": true
      },
      "notes": "Fetch the next task's details"
    },
    {
      "id": "Set_PrepareEmail",
      "name": "Prepare Email Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [1220, 300],
      "parameters": {
        "keepOnlySet": false,
        "values": {
          "string": [
            {
              "name": "next_assignee_email",
              "value": "={{ $json.properties?.Email?.email || $json.properties?.Assignee?.people?.[0]?.person?.email || '' }}"
            },
            {
              "name": "next_assignee_name",
              "value": "={{ $json.properties?.Assignee?.people?.[0]?.name || $json.properties?.['Assignee Name']?.rich_text?.[0]?.plain_text || 'Team Member' }}"
            },
            {
              "name": "next_task_name",
              "value": "={{ $json.properties?.Name?.title?.[0]?.plain_text || $json.properties?.Title?.title?.[0]?.plain_text || 'Finance Task' }}"
            },
            {
              "name": "next_task_url",
              "value": "={{ $json.url }}"
            },
            {
              "name": "next_due_date",
              "value": "={{ $json.properties?.['Due Date']?.date?.start || 'TBD' }}"
            },
            {
              "name": "completed_task_name",
              "value": "={{ $('NotionTrigger_TaskUpdated').item.json.properties?.Name?.title?.[0]?.plain_text || 'Previous task' }}"
            },
            {
              "name": "email_subject",
              "value": "ðŸ”” Month-End Step Ready: {{ $json.properties?.Name?.title?.[0]?.plain_text }}"
            },
            {
              "name": "email_body",
              "value": "Hi {{ $json.properties?.Assignee?.people?.[0]?.name || 'there' }},\n\nThe previous step in the month-end close process (\"{{ $('NotionTrigger_TaskUpdated').item.json.properties?.Name?.title?.[0]?.plain_text }}\") has been marked **Done**.\n\nâœ… Your step is now ready:\n\n**Task**: {{ $json.properties?.Name?.title?.[0]?.plain_text }}\n**Due**: {{ $json.properties?.['Due Date']?.date?.start || 'TBD' }}\n**Link**: {{ $json.url }}\n\nPlease review and complete at your earliest convenience.\n\n---\n*Automated by Finance Ops Bot*"
            }
          ]
        }
      },
      "notes": "Extract and format data for email"
    },
    {
      "id": "Email_Send",
      "name": "Send Email to Next Assignee",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [1460, 300],
      "credentials": {
        "smtp": {
          "id": "YOUR_SMTP_CREDENTIAL_ID",
          "name": "Finance SMTP"
        }
      },
      "parameters": {
        "fromEmail": "finance-bot@yourcompany.com",
        "toEmail": "={{ $json.next_assignee_email }}",
        "subject": "={{ $json.email_subject }}",
        "text": "={{ $json.email_body }}",
        "options": {
          "ccEmail": "finance-lead@yourcompany.com",
          "appendAttribution": false
        }
      },
      "notes": "Send email notification"
    },
    {
      "id": "Notion_UpdateNextTaskStatus",
      "name": "Update Next Task Status",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [1700, 300],
      "parameters": {
        "resource": "page",
        "operation": "update",
        "pageId": "={{ $('Notion_GetNextStep').item.json.id }}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Status",
              "selectValue": "Ready to Start"
            },
            {
              "key": "Notified At",
              "dateValue": "={{ $now.toISO() }}"
            }
          ]
        }
      },
      "credentials": {
        "notionApi": {
          "id": "1",
          "name": "Notion API"
        }
      },
      "notes": "Mark next task as 'Ready to Start'"
    },
    {
      "id": "Set_LogActivity",
      "name": "Log Handoff Activity",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [1940, 300],
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "handoff_timestamp",
              "value": "={{ $now.toISO() }}"
            },
            {
              "name": "from_task",
              "value": "={{ $('NotionTrigger_TaskUpdated').item.json.properties?.Name?.title?.[0]?.plain_text }}"
            },
            {
              "name": "to_task",
              "value": "={{ $('Notion_GetNextStep').item.json.properties?.Name?.title?.[0]?.plain_text }}"
            },
            {
              "name": "to_assignee",
              "value": "={{ $('Set_PrepareEmail').item.json.next_assignee_name }}"
            },
            {
              "name": "notification_sent",
              "value": "email"
            }
          ]
        }
      },
      "notes": "Optional: Log for analytics"
    }
  ],
  "connections": {
    "NotionTrigger_TaskUpdated": {
      "main": [
        [
          {
            "node": "If_StatusDone",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_StatusDone": {
      "main": [
        [
          {
            "node": "If_HasNextStep",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_HasNextStep": {
      "main": [
        [
          {
            "node": "Notion_GetNextStep",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion_GetNextStep": {
      "main": [
        [
          {
            "node": "Set_PrepareEmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set_PrepareEmail": {
      "main": [
        [
          {
            "node": "Email_Send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email_Send": {
      "main": [
        [
          {
            "node": "Notion_UpdateNextTaskStatus",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion_UpdateNextTaskStatus": {
      "main": [
        [
          {
            "node": "Set_LogActivity",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-01-16T00:00:00.000Z",
      "updatedAt": "2025-01-16T00:00:00.000Z",
      "id": "2",
      "name": "finance"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-01-16T00:00:00.000Z",
  "versionId": "1"
}
